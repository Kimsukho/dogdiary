<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <head th:replace="fragments/head :: headFragment"></head>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <div class="wrapper">
        <aside th:replace="fragments/sidebar :: sidebar"></aside>

        <div class="main-content-wrapper" id="mainContentWrapper">
            <header th:replace="fragments/header :: header(title=${title})"></header>

            <main layout:fragment="content">
            </main>
            <footer th:replace="fragments/footer :: footer"></footer>
        </div>
    </div>

    <div id="toast">ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤!</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar'); // sidebar fragmentì— id="sidebar"ê°€ ì¶”ê°€ë˜ì–´ì•¼ í•¨

            if (!sidebar) {
                console.error("Sidebar element with id 'sidebar' not found. Please ensure sidebar fragment has id='sidebar'.");
                return; // ì‚¬ì´ë“œë°”ê°€ ì—†ìœ¼ë©´ ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•ŠìŒ
            }

            const sidebarTitle = sidebar.querySelector('.sidebar-title');
            const sidebarCollapsedTitle = sidebar.querySelector('.sidebar-collapsed-title');

            function setInitialSidebarState() {
                if (window.innerWidth <= 1024) { // íƒœë¸”ë¦¿ ì‚¬ì´ì¦ˆê¹Œì§€ëŠ” ê¸°ë³¸ ì ‘í˜
                    sidebar.classList.add('collapsed');
                    if (sidebarTitle) sidebarTitle.style.display = 'none';
                    if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'block';
                } else {
                    sidebar.classList.remove('collapsed');
                    if (sidebarTitle) sidebarTitle.style.display = 'block';
                    if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'none';
                }
            }
            setInitialSidebarState();

            if (sidebarToggle) { 
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                    
                    if (sidebar.classList.contains('collapsed')) {
                        if (sidebarTitle) sidebarTitle.style.display = 'none';
                        if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'block';
                    } else {
                        if (sidebarTitle) sidebarTitle.style.display = 'block';
                        if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'none';
                    }
                });
            } else {
                console.warn("Sidebar toggle button with id 'sidebarToggle' not found. Sidebar toggling will not work.");
            }

            function handleResize() {
                if (window.innerWidth <= 1024) {
                    if (!sidebar.classList.contains('collapsed')) { // ì•„ì§ ì ‘íˆì§€ ì•Šì•˜ë‹¤ë©´
                        sidebar.classList.add('collapsed');
                        if (sidebarTitle) sidebarTitle.style.display = 'none';
                        if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'block';
                    }
                } else { // PC í™”ë©´ ì´ìƒ
                    // PC í™”ë©´ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í¼ì³ì§„ ìƒíƒœ (í˜¹ì€ ì´ì „ ìƒíƒœ ìœ ì§€)
                    sidebar.classList.remove('collapsed');
                    if (sidebarTitle) sidebarTitle.style.display = 'block';
                    if (sidebarCollapsedTitle) sidebarCollapsedTitle.style.display = 'none';
                }
            }
            window.addEventListener('resize', handleResize);
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('reveal');
                setTimeout(() => {
                    toast.classList.remove('reveal');
                }, 3000);
            } else {
                console.warn("Toast element with id 'toast' not found.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
           setTimeout(() => {
               showToast('í™˜ì˜í•©ë‹ˆë‹¤, ì‚¬ìš©ì7714ë‹˜! ğŸ˜Š');
           }, 1500);
        });
    </script>
</body>
</html>