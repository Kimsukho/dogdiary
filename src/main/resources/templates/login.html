<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link rel="icon" href="/favicon.png" type="image/png">
	<title th:text="${pageTitle} ?: '펫케어 시스템'">펫케어 시스템</title>
	<link rel="stylesheet" th:href="@{/css/loginStyle.css}" type="text/css">
	<script src="http://code.jquery.com/jquery-latest.js"></script> 
</head>
<body>
	<div id="container" class="container">
	    <div class="row">	      
			<!-- 회원가입 -->
			<div id="signUp" class="col align-items-center flex-col sign-up">
				<h1 style="margin-bottom: 3%; color: #4EA685">
					회원가입
				</h1>
				<div class="form-wrapper align-items-center">
					<div class="form sign-up">
						<div class="input-group">
						<i class='bx bxs-user'></i>
						<input type="text" placeholder="아이디">
						</div>
						<div class="input-group">
						<i class='bx bx-mail-send'></i>
						<input type="email" placeholder="이메일">
						</div>
						<div class="input-group">
						<i class='bx bxs-lock-alt'></i>
						<input type="password" placeholder="비밀번호">
						</div>
						<div class="input-group">
						<i class='bx bxs-lock-alt'></i>
						<input type="password" placeholder="비밀번호 재확인">
						</div>
						<button>
						회원가입
						</button>
						<p>
						<span>
							이미 계정이 있으신가요?
						</span>
						<b onclick="backToLogin()" class="pointer">
							로그인
						</b>
										<div id="toast"></div>
						</p>
					</div>
				</div>
			</div>

			<!--  비밀번호변경 -->
			<div id="forgotPwd" class="col align-items-center flex-col forgot-pwd">
				<h1 style="margin-bottom: 7%; color: #4EA685">
					비밀번호 재설정
				</h1>
				<div class="form-wrapper align-items-center">
				<div class="form forgot-pwd">
					<div class="input-group">
						<i class='bx bxs-user'></i>
						<input type="text" placeholder="아이디">
					</div>
					<div class="input-group">
						<i class='bx bxs-lock-alt'></i>
						<input type="password" placeholder="현재 비밀번호">
					</div>
					<div class="input-group">
						<i class='bx bxs-lock-alt'></i>
						<input type="password" placeholder="새 비밀번호">
					</div>
					<div class="input-group">
						<i class='bx bxs-lock-alt'></i>
						<input type="password" placeholder="새 비밀번호 확인">
					</div>
					<button>비밀번호 변경하기</button>
					<p>
						<span>이미 계정이 있으신가요?</span>
						<b onclick="backToLogin()" class="pointer">로그인</b>
					</p>
				</div>
			</div>
		</div>
		
		  <!-- 로그인 -->
			<div id="signIn" class="col align-items-center flex-col sign-in">
				<h1 style="margin-bottom: 3%; color: #4EA685">
					로그인
				</h1> 
				<div class="form-wrapper align-items-center">
	          <div class="form sign-in">
	            <div class="input-group">
	              <i class='bx bxs-user'></i>
	              <input id="loginInputId" type="text" placeholder="아이디">
	            </div>
	            <div class="input-group">
	              <i class='bx bxs-lock-alt'></i>
	              <input id="loginInputPassword" type="password" placeholder="비밀번호">
	            </div>
	            <button onclick="login()">
	              로그인
	            </button>
	            <p>
	              <b onclick="forgotPwd()" class="pointer">
	                비밀번호를 잊으셨나요?
	              </b>
	            </p>
	            <p>
	              <span>
	                계정이 없으신가요?
	              </span>
	              <b onclick="toggle()" class="pointer">
	                가입하기
	              </b>
	            </p>
	          </div>
	        </div>
	        <div class="form-wrapper">
	    
	        </div>
	      </div>
	    </div>

		<!-- 초록색 부분 -->
	    <div class="row content-row">
	      <!-- SIGN IN CONTENT -->
	      <div class="col align-items-center flex-col">
	        <div class="text sign-in">
	          <h2>
	            Welcome!
							<br>
							Dog Diary🐶
	          </h2>
	  
	        </div>
	        <div class="img sign-in">
	    
	        </div>
	      </div>
	      <div class="col align-items-center flex-col">
	        <div class="img sign-up">
	        
	        </div>
	        <div class="text sign-up">
	          <h2>
	            Join with us😺
	          </h2>
	  
	        </div>
	      </div>

				<div class="col align-items-center flex-col">
					<div class="img forgot-pwd">
						<!-- 비밀번호 재설정 관련 이미지 (선택사항) -->
					</div>
					<div class="text forgot-pwd">
						<h2>
							Reset your <br>
							password 🔑
						</h2>
						<p>
							새 비밀번호를 입력하고 계정을 안전하게 지키세요.
						</p>
					</div>
				</div>

	    </div>
	    
    	<script>
		  let container = document.getElementById('container');
		
			function toggle() {
				container.classList.remove('forgot-pwd'); // 비번재설정 모드 해제
				container.classList.toggle('sign-in');
				container.classList.toggle('sign-up');
			}

			function forgotPwd() {
				container.classList.remove('sign-in');
				container.classList.remove('sign-up');
				container.classList.add('forgot-pwd');
			}

			function backToLogin() {
				container.classList.remove('sign-up');
				container.classList.remove('forgot-pwd');
				container.classList.add('sign-in');
			}

			let removeToast;

			function toast(string) {
					const toast = document.getElementById("toast");

					toast.classList.contains("reveal") ?
							(clearTimeout(removeToast), removeToast = setTimeout(function () {
									document.getElementById("toast").classList.remove("reveal")
							}, 1000)) :
							removeToast = setTimeout(function () {
									document.getElementById("toast").classList.remove("reveal")
							}, 1000)
					toast.classList.add("reveal"),
							toast.innerText = string
			}

			function login() {
				let loginId = document.getElementById("loginInputId").value;
				let password = document.getElementById("loginInputPassword").value;
				
				if(!loginId || !password) {
					toast('아이디와 비밀번호를 입력해주세요.');
					return;
				}

				$.ajax({
					url: '/api/public/authenticate',
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					data: JSON.stringify({ username: loginId, password: password }),
					success: function(data, textStatus, jqXHR) {
						console.log('로그인 성공:', data);
						// 사용자 role에 따라 리다이렉트
						let userRole = data.role || '';
						// ADMIN 또는 ROLE_ADMIN인 경우 관리자 페이지로, 그 외에는 대시보드로
						if (userRole === 'ADMIN' || userRole === 'ROLE_ADMIN') {
							window.location.href = '/admin/users';
						} else {
							window.location.href = '/dashboard';
						}
					},
					error: function(xhr, status, error) {
						console.error('로그인 실패:', error);
						let errorMessage = '로그인에 실패했습니다. 아이디와 비밀번호를 확인해주세요.';
						
						if(xhr.responseJSON && xhr.responseJSON.message) {
							errorMessage = xhr.responseJSON.message;
						}
						
						toast(errorMessage);
					}
				});
			}

			function logout() {
				// Spring Security의 logout 엔드포인트 사용
				window.location.href = '/logout';
			}
		
		  // 초기 상태: 로그인 화면
		  setTimeout(() => {
		    container.classList.add('sign-in');
		  }, 200);
		</script>

  </div>
</body>
</html>