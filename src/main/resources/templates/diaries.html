<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main-layout}">
<head>
    <title>일지 관리</title>
</head>
<body>
<div layout:fragment="content">
    <div class="diary-page">
        <div class="diary-page-header">
            <h3>일지 목록</h3>
            <button class="diary-add-button" onclick="alert('일지 작성')">
                <i class="fas fa-plus"></i> 새 일지 작성
            </button>
        </div>

        <div class="diary-cards" id="diaryCards">
            <div id="emptyCard" class="empty-card">등록된 일지가 없습니다.</div>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script th:src="@{/lib/axios/axios.min.js}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const diaryCards = document.getElementById('diaryCards');
            const emptyCard = document.getElementById('emptyCard');

            // mood별 클래스 매핑
            const moodClassMap = {
                'HAPPY': 'mood-Happy',
                'SAD': 'mood-Sad',
                'ANGRY': 'mood-Angry',
                'EXCITED': 'mood-Excited'
            };

            async function loadDiaryData() {
                try {
                    const response = await axios.get('/api/getAllDiaries');
                    if (response.data.returnCode === "SUCCESS") {
                        const data = response.data.resultData;
                        diaryCards.innerHTML = '';

                        if (data.length === 0) {
                            diaryCards.appendChild(emptyCard);
                            emptyCard.style.display = 'flex';
                        } else {
                            data.forEach(diary => {
                                const moodClass = moodClassMap[diary.mood] || 'mood-';
                                const card = document.createElement('div');
                                card.className = 'diary-card';
                                card.innerHTML = `
                                    <div class="diary-card-header">${diary.name}</div>
                                    <div class="diary-card-content">${diary.content}</div>
                                    <div class="diary-footer">
                                        <div class="diary-mood ${moodClass}">${diary.mood || '-'}</div>
                                        <div class="diary-date">${new Date(diary.last_updated).toLocaleDateString('ko-KR')}</div>
                                    </div>
                                    <div class="diary-actions">
                                        <button class="edit-btn" data-id="${diary.id}" title="수정">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="delete-btn" data-id="${diary.id}" title="삭제">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `;
                                diaryCards.appendChild(card);
                            });
                        }
                    }
                } catch (error) {
                    console.error('일지 데이터 불러오기 실패:', error);
                    diaryCards.innerHTML = '';
                    diaryCards.appendChild(emptyCard);
                    emptyCard.style.display = 'flex';
                }
            }

            loadDiaryData();
        });
        </script>

</th:block>
</body>
</html>
